trigger: none   # run manually

pool:
  name: Default
  demands:
    - Agent.OS -equals Windows_NT

variables:
  TF_VERSION: '1.6.6'

steps:
- checkout: self

- task: TerraformInstaller@1
  inputs:
    terraformVersion: $(TF_VERSION)

- task: AzureCLI@2
  displayName: "Terraform Bootstrap (State + Providers)"
  inputs:
    azureSubscription: 'ALZ_SC01'
    scriptType: ps
    scriptLocation: inlineScript
    inlineScript: |
      cd 0-bootstrap
      terraform init -reconfigure
      terraform fmt -check
      terraform validate
      terraform plan
      terraform apply -auto-approve